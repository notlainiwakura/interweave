<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... -->
    <!-- Link to the external CSS file -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="chat-container">
        <!-- Chat Header -->
        <div class="chat-header">
            <h1>Welcome, {{ username }}!</h1>
            <a href="{{ url_for('profile') }}" class="btn-link">Profile</a>
        </div>

        <!-- Chat Box where messages appear -->
        <div class="chat-box" id="chat-window">
            <!-- Chat messages will be appended here -->
        </div>

        <!-- Chat Form for user input -->
        <div class="chat-form">
            <input type="text" id="user-input" class="chat-input" placeholder="Type your message...">
            <button class="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let conversationState = 'start';
        let currentQuestionIndex = null;

        function sendMessage() {
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();
            userInput.value = '';

            if (message !== '') {
                displayMessage('You', message);

                fetch('/chat_api', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversation_state: conversationState,
                        current_question_index: currentQuestionIndex
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    displayMessage('Bot', data.reply);
                    conversationState = data.conversation_state;
                    currentQuestionIndex = data.current_question_index;
                });
            }
        }

        function displayMessage(sender, message) {
            const chatWindow = document.getElementById('chat-window');
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', sender.toLowerCase());

            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.textContent = message;

            messageElement.appendChild(messageContent);
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
    </script>
</body>
</html>
